<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="THEO Tizen Reference App" />
    <title>App</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/theo-player.css">
    <script type="text/javascript" src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/4e18b04e59.js" crossorigin="anonymous"></script>
    <script src='../libs/THEOplayer.chromeless.js'></script>
    <script src="../js/track-language.js"></script>
    <script src="../js/history.min.js"></script>
</head>

<body>
    <div class="loader-blue" id="spinner" style="display: block;">Loading...</div>
    <div class='theoplayer-tizen'></div>
    <div class="menu-right" id="menu-right"></div>
    <div id="video-controls" class="video-controls" style="display: none;">
        <div id="timee" class="timer" style="display: none;">
            <span id="currentTime" class="cusTime">0:0:0</span><span class="cusTime"> / </span><span id="totalTime"
                class="cusTime">0:0:0</span>
        </div>
        <div id="live" class="timer" style="display: none;">
            <span class="live">LIVE</span>
        </div>
        <div class="progress cusProgress" id="cusProgress" style="display: none;">
            <div id="progress-bar" class="progress-bar bg-primary" style="height:20px"></div>
        </div>
        <div class="controlposition">
            <div class="innerBlock" id="innerBlock">
                <button id="rew" class="btn btn-outline-primary rew" style="display: none;">
                    <i class="fa fa-backward"></i>
                </button>
                <button id="pause" class="btn btn-outline-primary play playPause current" style="display: none;">
                    <i id="playPauseIcon" class="fa fa-play"></i>
                </button>
                <button id="ff" class="btn btn-outline-primary ff" style="display: none;">
                    <i class="fa fa-forward"></i>
                </button>
                <button id="speed" class="btn btn-outline-primary speed" style="display: none;">
                    <i class="fas fa-tachometer-alt-slow"></i>
                </button>
            </div>
        </div>
    </div>
    <p class="live_sec" style="display: none;">
        <!-- <i class="fa fa-circle" aria-hidden="true"></i> -->
        <span>&nbsp;LIVE</span>
    </p>
    <div class="mainContainer" id="auto_play_div" style="display: none;">
        <div class="polaroid">
            <div class="queue">
                <h1>In Queue</h1>
            </div>
            <div class="playersec" id="playersec">
                <img class="previous" src="ic_skip_previous.png" id="previous"></img>
                <img class="next" src="ic_skip_next.png" id="next"></img>
            </div>
        </div>
        <img id="autoplay_image" src="" alt="autoplay image">
        <div class="header">
            <h1 id="title"
                style="max-width:400px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;margin:0 auto;">
            </h1>
        </div>
    </div>
    <div class="contaner error-container" id="error_notific" style="display: none;">
        <div class="row">
            <div class="col-lg-12">
                <h2>Player Notification</h2>
            </div>
            <div class="col-lg-8">
                <div class="left-side">
                    <p class="error-desc" id="error-desc"></p>
                    <p class="error-msg" id="error-msg"></p>
                    <p class="error-code" id="error-code">Erroe Code : <span id="error_num"></span></p>
                    <div style="margin-top: 31px;" id='error_btn-div'>
                        <button class="btn btn-outline-primary" id="error_back">Back</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="right-icon" style="position: relative;">
                    <img src="error.png">
                </div>
            </div>
        </div>
    </div>

    <script>
        // for error handling
        var errorNotificShow = false;
        var errorTimeout = '';
        // for page redirect
        var counter = -1;
        // video log
        var authtoken = localStorage.getItem("authtokenstr");
        var baseurl = localStorage.getItem("baseurl");
        var ip_address = localStorage.getItem("ip_address");
        var episode_id = 0;
        var watch_status = '';
        var device_type = "1";
        var log_id = 0;
        var content_type = '';
        var is_streaming_restriction = "0";
        var restrict_stream_id = "0";
        var is_active_stream_closed = "0";
        var played_length = 0;
        var log_temp_id = '0';
        var resume_time = '';
        var user_id = '';
        var trailer = "false";
        var newLogId = 0;
        // subtile and multi audio
        var subtileBtnShow = false;
        var subtileList = '';
        var subTitleCount = 0;
        //multi audio
        var audioBtnShow = false;
        var audioList = '';
        var audioCount = 0;
        // get from url 
        var multipart = "";
        var muvi_uniq_id;
        var stream_uniq_id;
        var playlength = 0;
        // media queue
        var mediaQueueResponse = '';
        // autoplay
        var auto_play_content_uniq_id = '';
        var auto_play_content_types_id = '';
        var auto_play_stream_uniq_id = '';
        var autoplay = 0;
        // for getting video source
        var videoSrc = '';
        // for getting subtitle array
        var subtileArray = [];

        // get trailor from localstorage
        trailer = localStorage.getItem("trailer");

        // getting userid from localstorage
        if (localStorage.getItem("loginstr") != null) {
            user_id = localStorage.getItem("loginstr");
            console.log(user_id);
        }
        // for page history
        if (localStorage.getItem("count") != null) {
            counter = localStorage.getItem("count");
        } else {
            counter = -1;
        }
        // autoplay
        if ("autoplayavialble" in localStorage) {
            autoplay = localStorage.getItem("autoplayavialble");
        } else {
            autoplay = 0;
        }

        function getParameterByName(name, href) {
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            var regexS = "[\\?&]" + name + "=([^&#]*)";
            var regex = new RegExp(regexS);
            var results = regex.exec(href);
            if (results == null)
                return "";
            else
                return decodeURIComponent(results[1].replace(/\+/g, " "));
        }
        stream_uniq_id = getParameterByName("stream_uniq_id", window.location.href);
        muvi_uniq_id = getParameterByName("muvi_uniq_id", window.location.href);
        playlength = getParameterByName("playlength", window.location.href);
        multipart = getParameterByName("multipart", window.location.href);

        console.log(stream_uniq_id);
        console.log(muvi_uniq_id);
        console.log(playlength);
        console.log(multipart);

        // for episode check
        if (multipart == "3") {
            episode_id = stream_uniq_id;
        } else {
            episode_id = 0;
        }

        var _videourl = localStorage.getItem("url");
        var licenseurl = localStorage.getItem("licenseurl");
        var _video_extension = _videourl.split('.').pop().split(/\#|\?/)[0];
        console.log(_videourl);
        console.log(licenseurl);
        console.log(_video_extension);

        function videolognew(authtoken, baseurl, ip_address, muvi_uniq_id, episode_id, watch_status, device_type, log_id, content_type, is_streaming_restriction, restrict_stream_id, is_active_stream_closed, played_length, log_temp_id, resume_time, user_id) {
            console.log(watch_status);
            console.log(content_type);
            console.log(played_length);
            console.log(resume_time);
            var videodetailsxhttp = new XMLHttpRequest();
            videodetailsxhttp.onreadystatechange = function () {
                //$('#spinner').show();
                if (this.readyState == 4 && this.status == 200) {
                    //$('#spinner').hide();
                    var videodetails_response = JSON.parse(this.responseText);
                    console.log(videodetails_response);
                    if (videodetails_response.code == 200) {
                        log_id = videodetails_response.log_id;
                        log_temp_id = videodetails_response.log_temp_id;
                        newLogId = log_id;
                    } else {
                        console.log("fails");
                    }
                }
            };
            videodetailsxhttp.open("GET", "" + baseurl + "VideoLogNew?authToken=" + authtoken + "&ip_address=" + ip_address + "&movie_id=" + muvi_uniq_id + "&episode_id=" + episode_id + "&watch_status=" + watch_status + "&device_type=" + device_type + "&log_id=" + log_id + "&content_type=" + content_type + "&is_streaming_restriction=" + is_streaming_restriction + "&restrict_stream_id=" + restrict_stream_id + "&is_active_stream_closed=" + is_active_stream_closed + "&played_length=" + played_length + "&log_temp_id=" + log_temp_id + "&resume_time=" + resume_time + "&user_id=" + user_id + "", true);
            videodetailsxhttp.send();
        }//End
        function mediaqueueApi() {
            var mediaqueuexhr = new XMLHttpRequest();
            mediaqueuexhr.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    mediaQueueResponse = JSON.parse(this.responseText);
                    var mediaqueue = mediaQueueResponse;
                    localStorage.setItem("mediaqueueresponse", JSON.stringify(mediaQueueResponse));
                    console.log(mediaQueueResponse);
                    if (mediaQueueResponse.code == 200) {
                        if (Object.getOwnPropertyNames(mediaQueueResponse.next_media_info).length > 0) {
                            $("#title").text(mediaQueueResponse.next_media_info.content_title);
                            $("#autoplay_image").attr("src", mediaQueueResponse.next_media_info.poster_for_tv);
                            auto_play_content_uniq_id = mediaQueueResponse.next_media_info.content_uniq_id;
                            localStorage.setItem("content_uniq_id_video", auto_play_content_uniq_id);
                            auto_play_content_types_id = mediaQueueResponse.next_media_info.content_types_id;
                            localStorage.setItem("content_types_id", auto_play_content_types_id);
                            auto_play_stream_uniq_id = mediaQueueResponse.next_media_info.stream_uniq_id;
                            localStorage.setItem("stream_in_video", auto_play_stream_uniq_id);
                            localStorage.setItem("autoplayavialble", "1");
                            autoplay = 1;
                        } else {
                            localStorage.setItem("autoplayavialble", "0");
                        }
                        if (Object.getOwnPropertyNames(mediaQueueResponse.previous_media_info).length == 0) {
                            $("#previous").hide();
                        }
                    }
                }
            }
            mediaqueuexhr.open("GET", "" + baseurl + "getmediaqueue?authToken=" + authtoken + "&stream_uniq_id=" + stream_uniq_id + "&content_info=1", true);
            mediaqueuexhr.send();
        }//End
        var timeOut = '';
        function toggleSeekbar(time) {
            document.getElementById("video-controls").style.display = "block";
            timeOut = setTimeout(function () {
                document.getElementById("video-controls").style.display = "none";
                document.getElementById("auto_play_div").style.display = "none";
                menuDefaultActive();
            }, time)
        }
        function cancelTimeout(time) {
            clearTimeout(timeOut);
            toggleSeekbar(time)
        }
        function customBack(customCounter) {
            errorNotificShow = false;
            played_length = Math.floor(player.currentTime);
            //resume_time=played_length;
            log_id = newLogId;
            var videodetailsxhttp = new XMLHttpRequest();
            videodetailsxhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var videodetails_response = JSON.parse(this.responseText);
                    console.log(videodetails_response);
                    if (videodetails_response.code == 200) {
                        log_id = videodetails_response.log_id;
                        log_temp_id = videodetails_response.log_temp_id;
                    } else {
                        console.log("fails");
                    }
                    localStorage.removeItem("count");
                    localStorage.removeItem("autoplayavialble");
                    localStorage.removeItem("customCounter");
                    let arrObj = JSON.parse(localStorage.getItem("historyArray"));
                    for (var i = 0; i < customCounter; i++) {
                        arrObj.pop();
                    }
                    console.log(arrObj);
                    if (arrObj.length > 0) {
                        window.location.href = arrObj[arrObj.length - 1];
                        arrObj.pop();
                        localStorage.setItem("historyArray", JSON.stringify(arrObj));
                    } else {
                        window.history.back();
                    }
                }
            };
            videodetailsxhttp.open("GET", "" + baseurl + "VideoLogNew?authToken=" + authtoken + "&ip_address=" + ip_address + "&movie_id=" + muvi_uniq_id + "&episode_id=" + episode_id + "&watch_status=" + watch_status + "&device_type=" + device_type + "&log_id=" + log_id + "&content_type=" + content_type + "&is_streaming_restriction=" + is_streaming_restriction + "&restrict_stream_id=" + restrict_stream_id + "&is_active_stream_closed=" + is_active_stream_closed + "&played_length=" + played_length + "&log_temp_id=" + log_temp_id + "&resume_time=" + resume_time + "&user_id=" + user_id + "", true);
            videodetailsxhttp.send();
        }

        function checkOnlineConnection() {
            var ipaddress = new XMLHttpRequest();
            ipaddress.onreadystatechange = function () {
                if (this.readyState == 4) {
                    if (this.status >= 200 && this.status < 304) {
                        var ipaddress_response = JSON.parse(this.responseText);
                        console.log(ipaddress_response);
                        console.log("connection exists!");
                    } else {
                        var $current = $('.current');
                        $current.removeClass('current');
                        $("#error_back").addClass("current");
                        document.getElementById("spinner").style.display = "none";
                        document.getElementById("error-desc").innerHTML = "Internet may be disconnected!!";
                        document.getElementById("error-msg").innerHTML = "Trying to reconnect";
                        document.getElementById("error_num").innerHTML = "12023";
                        document.getElementById("error_notific").style.display = 'block';
                    }
                }
            }
            ipaddress.open("GET", "https://api.ipify.org/?format=json", true);
            ipaddress.send();
        }

        // create video source accoding to extension
        if (_video_extension == 'm3u8') {
            videoSrc = {
                src: _videourl,
                type: 'application/x-mpegurl'
            }
        } else if (_video_extension == 'mpd') {
            videoSrc = {
                src: _videourl,
                type: 'application/dash+xml',
                drm: {
                    widevine: {
                        licenseAcquisitionURL: licenseurl,
                    }
                },
            }
        } else {
            videoSrc = {
                src: _videourl,
                type: 'video/mp4'
            }
        }
        // getting subtitile array from local storage
        if ("subtitleArr" in localStorage) {
            subtileArray = JSON.parse(localStorage.getItem("subtitleArr"));
        }
        console.log(_video_extension);
        console.log(videoSrc);
        console.log(subtileArray);

        var element = document.querySelector('.theoplayer-tizen');
        var player = new THEOplayer.Player(element, {
            fluid: true,
            libraryLocation: 'libs/'
        });

        var muviPlayerSource = {
            sources: [videoSrc],
            textTracks: subtileArray
        };
        // import video src and subtitle array 
        player.source = muviPlayerSource;

        player.preload = 'auto';
        player.autoplay = true;
        player.playbackRate = 1;
        player.currentTime += playlength;
        if (trailer == "false") {
            content_type = 1;
            mediaqueueApi();
        } else {
            content_type = 2;
        }
        // Remote key 
        var keyCodes = {
            LEFT: 37,
            UP: 38,
            RIGHT: 39,
            DOWN: 40,
            CONFIRM: 13,
            RETURN: 10009,
            EXIT: 10182,
            MEDIAPLAYPAUSE: 10252,
            MEDIAFASTFORWARD: 417,
            MEDIAREWIND: 412,
            MediaPlay: 415,
            MediaPause: 19,
            MediaStop: 413,
            Exit: 10182
        };
        if (typeof window.tizen !== "undefined") {
            window.tizen.tvinputdevice.registerKeyBatch(['MediaFastForward', 'MediaRewind', 'MediaPlayPause', 'MediaPlay', 'MediaPause', 'MediaStop', 'Exit']); // allow MediaPlayPause button
        }
        document.addEventListener('keydown', function (event) {
            switch (event.keyCode) {
                case keyCodes.CONFIRM:
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        enterKey();
                        cancelTimeout(20000);
                    }
                    break;
                case keyCodes.MEDIAPLAYPAUSE:
                    if (player.paused) {
                        player.play();
                        if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                            cancelTimeout(20000);
                        }
                    } else {
                        player.pause();
                        if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                            cancelTimeout(20000);
                        }
                    }
                    break;
                case keyCodes.MediaPlay:
                    player.play();
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        cancelTimeout(20000);
                    }
                    break;
                case keyCodes.MediaPause:
                    player.pause();
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        cancelTimeout(20000);
                    }
                    break;
                case keyCodes.UP:
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        upKey();
                        cancelTimeout(20000);
                    }
                    break;
                case keyCodes.DOWN:
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        downKey();
                        cancelTimeout(20000);
                    }
                    break;
                case keyCodes.LEFT:
                    //player.currentTime -= 10;
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        leftKey();
                        cancelTimeout(20000);
                    }
                    break;
                case keyCodes.RIGHT:
                    // player.currentTime += 10;
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        rightKey();
                        cancelTimeout(20000);
                    }
                    break;
                case keyCodes.MEDIAFASTFORWARD:
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        player.currentTime += 10;
                        cancelTimeout(20000);
                    }
                    break;
                case keyCodes.MEDIAREWIND:
                    if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                        cancelTimeout(20000);
                        player.currentTime -= 10;
                    }
                    break;
                case keyCodes.MediaStop:
                    player.stop();
                    watch_status = "halfplay";
                    if ("customCounter" in localStorage) {
                        customBack(localStorage.getItem("customCounter"));
                    } else {
                        customBack(1);
                    }
                    break;
                case keyCodes.RETURN:
                    watch_status = "halfplay";
                    played_length = Math.floor(player.currentTime);
                    resume_time = played_length;
                    if ("customCounter" in localStorage) {
                        customBack(localStorage.getItem("customCounter"));
                    } else {
                        customBack(1);
                    }
                    break;
                case keyCodes.EXIT:
                    localStorage.setItem("AppExit", "yes")
                    tizen.application.getCurrentApplication().exit();
            }
        });
        player.addEventListener(['play', 'pause'], function () {
            if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                cancelTimeout(15000);
            }
            if (player.paused) {
                var myEle = document.getElementById("play");
                if (myEle != null) {
                    document.getElementById("playPauseIcon").classList.remove("fa-pause");
                    document.getElementById("playPauseIcon").classList.add("fa-play");
                    document.getElementById("play").id = 'pause';
                }
                console.log('player is paused');
            } else {
                var myEle = document.getElementById("pause");
                if (myEle != null) {
                    document.getElementById("playPauseIcon").classList.remove("fa-play");
                    document.getElementById("playPauseIcon").classList.add("fa-pause");
                    document.getElementById("pause").id = 'play';
                }
                console.log('player is unpaused');
            }
        });

        player.addEventListener('playing', function () {
            // (hide spinner if we were waiting)
            console.log('player starts playing after unpause');
            if ((localStorage.getItem("trailer") == "true"||localStorage.getItem("trailer") == "false") && localStorage.getItem("content_types_id") != 4) {
                document.getElementById("spinner").style.display = "none";
                document.getElementById("cusProgress").style.display = "block";
                document.getElementById("timee").style.display = "block";
                document.getElementById("rew").style.display = "block";
                document.getElementById("play").style.display = "block";
                document.getElementById("ff").style.display = "block";
                document.getElementById("speed").style.display = "block";
                if (subtileBtnShow) {
                    subtileBtnShow = false;
                    $('<button id="subTitlebtn" class="btn btn-outline-primary subTitlebtn"><i class="fas fa-closed-captioning"></i></button>').insertAfter(".speed");
                    player.textTracks[0].mode = "showing";
                }
                if (audioBtnShow) {
                    audioBtnShow = false;
                    var subtileDiv = document.getElementById("subTitlebtn");
                    if (subtileDiv != null) {
                        $('<button id="audio_btn" class="btn btn-outline-primary audio_btn"><i class="fas fa-headphones"></i></button>').insertAfter(".subTitlebtn");
                    } else {
                        $('<button id="audio_btn" class="btn btn-outline-primary audio_btn"><i class="fas fa-headphones"></i></button>').insertAfter(".speed");
                    }
                }

                toggleSeekbar(25000);
            } else {
                $(".live_sec").show();
            }
        });

        player.addEventListener('seeking', 'seeked', function () {
            if (player.seeking) {
                // (show spinner)
                console.log('player is seeking to', player.currentTime);
                document.getElementById("spinner").style.display = "block";
            } else {
                // (hide spinner)
                console.log('playing is done seeking to', player.currentTime);
                document.getElementById("spinner").style.display = "none";
            }
        });

        player.addEventListener('waiting', function () {
            document.getElementById("spinner").style.display = "block";
            console.log('player is waiting for data');
            errorTimeout = setTimeout(function () {
                checkOnlineConnection();
            }, 5000)
        });

        function _fillNumber(num) {
            return (num < 10) ? '0' + num : num;
        }
        function foramtTheString(time) {
            if (time > 3600) {
                return 'hh:mm:ss';
            }
            else {
                return 'mm:ss';
            }
        }
        function timeFormat(time) {
            var format = foramtTheString(time), isNegative = time < 0, neutralisedTime = Math.abs(time);
            return format.replace('-', isNegative ? '-' : '')
                .replace('hh', Math.floor(neutralisedTime / 3600) + '')
                .replace('mm', _fillNumber(Math.floor(neutralisedTime / 60) % 60)) // remove _fillNumber-method if you don't want 9 to be displayed as 09
                .replace('ss', _fillNumber(Math.floor(neutralisedTime % 60)));
        }

        player.addEventListener('timeupdate', function () {
            document.getElementById('currentTime').innerHTML = timeFormat(player.currentTime);
            var percentage = (player.currentTime / player.duration) * 100;
            document.getElementById('progress-bar').style.width = percentage + "%";
            played_length = Math.floor(player.currentTime);
            // showing autoplay before 10 sec (if available)
            var totalDuration = Math.floor(player.duration);
            var show_autoplay_time = totalDuration - 10;
            if (played_length == show_autoplay_time) {
                if (localStorage.getItem("autoplayavialble") == "1") {
                    $("#auto_play_div").show();
                }
            }
            // log video duration on every 60 sec and start
            if ((played_length % 60) == 0) {
                console.log(played_length);
                resume_time = played_length;
                log_id = newLogId;
                watch_status = "halfplay";
                videolognew(authtoken, baseurl, ip_address, muvi_uniq_id, episode_id, watch_status, device_type, log_id, content_type, is_streaming_restriction, restrict_stream_id, is_active_stream_closed, played_length, log_temp_id, resume_time, user_id);
            }

        });

        player.addEventListener('durationchange', function () {
            console.log('duration is changed to', player.duration);
            if (isNaN(player.duration)) {
                console.log('NaN')
            } else if (player.duration === Infinity) {
                // durationDisplay.textContent = 'Live';
                // player.element.classList.add('theo-live');
            } else {
                document.getElementById('totalTime').innerHTML = timeFormat(player.duration);
            }
        });

        player.addEventListener('ended', function () {
            watch_status = "completed";
            resume_time = 0;
            videolognew(authtoken, baseurl, ip_address, muvi_uniq_id, episode_id, watch_status, device_type, log_id, content_type, is_streaming_restriction, restrict_stream_id, is_active_stream_closed, played_length, log_temp_id, resume_time, user_id);
            if (autoplay == 1) {
                counter = counter - 1;
                localStorage.setItem("count", counter);
                $(location).attr('href', "autoplaydesc.html?content_uniq_id=" + auto_play_content_uniq_id + "&stream_uniq_id=" + auto_play_stream_uniq_id + "&click_key=next" + "&content_types_id=" + auto_play_content_types_id);
            } else {
                if ("customCounter" in localStorage) {
                    customBack(localStorage.getItem("customCounter"));
                } else {
                    customBack(1);
                }
            }
            console.log('video ended');
        });

        // Get track language from local language
        function getLanguageByLnagCode(langCode, type) {
            var reurnLanguage = storeLanguage.find(lang => lang.code === langCode);
            if (reurnLanguage === undefined) {
                reurnLanguage = type + " (" + langCode + ")";
            } else {
                reurnLanguage = reurnLanguage.name;
            }
            return reurnLanguage;
        }

        // Create Audio and Video right menu
        var subtitle = ' <div class="menu-item" id="subtitle_off">Off</div>';
        var audio = '';
        function createElementInRightMenu(track, menuType) {
            if (menuType === "AUDIO") {
                var show_language = '';
                if (track.label != "") {
                    show_language = track.label;
                } else {
                    var langCode = track["language"];
                    show_language = getLanguageByLnagCode(langCode, "Audio")
                }
                audio += '<div class="menu-item" id="audio_' + player.audioTracks.indexOf(track) + '">' + show_language + '</div>';
                return audio;
            } else if (menuType == "SUBTILE") {
                var show_language = '';
                if (track.label != "") {
                    show_language = track.label;
                } else {
                    var langCode = track["language"];
                    show_language = getLanguageByLnagCode(langCode, "Subtitle")
                }
                subtitle += '<div class="menu-item" id="subtitle_' + player.textTracks.indexOf(track) + '">' + show_language + '</div>'
                return subtitle;
            }
        }

        player.textTracks.addEventListener('addtrack', function (addTrackEvent) {
            var track = addTrackEvent.track;
            var _subtileTrackLength = player.textTracks.length;
            subtileList = createElementInRightMenu(track, "SUBTILE");
            subTitleCount++;
            if (subTitleCount == _subtileTrackLength) {
                subtileBtnShow = true;
            }
            track.addEventListener('addcue', function (addCueEvent) {
                var cue = addCueEvent.cue;
            });
        });

        player.audioTracks.addEventListener('addtrack', function (addTrackEvent) {
            var track = addTrackEvent.track;
            var trackCount = player.audioTracks.length;
            //console.log(trackCount);
            audioList = createElementInRightMenu(track, "AUDIO");
            audioCount++;
            //console.log('audioCount'+audioCount);
            if (audioCount >= 2) {
                console.log('audio present');
                audioBtnShow = true;
            }
            track.addEventListener('addcue', function (addCueEvent) {
                var cue = addCueEvent.cue;
            });

        });
        player.videoTracks.addEventListener('addtrack', function (e) {
            console.log(e);
            e.track.qualities.forEach(function (quality, index) {
                console.log(quality.height);
            });
        });
        player.addEventListener('error', function (errorEvent) {
            errorNotificShow = true;
            player.pause();
            console.log(errorEvent);
            console.log(errorEvent.errorObject.message);
            console.log(errorEvent.errorObject.code);
            var code = errorEvent.errorObject.code;
            var errorMessage = '';
            if (errorObject.hasOwnProperty(code)) {
                errorMessage = errorObject[code];
            } else {
                errorMessage = "Something went wrong!";
            }

            var $current = $('.current');
            $current.removeClass('current');
            $("#error_back").addClass("current");
            document.getElementById("spinner").style.display = "none";
            document.getElementById("error-desc").innerHTML = errorMessage;
            document.getElementById("error_num").innerHTML = code;
            document.getElementById("error-msg").style.display = "none";
            document.getElementById("error_notific").style.display = 'block';
        });
        player.addEventListener('canplay', function (e) {
            clearTimeout(errorTimeout);
            document.getElementById("spinner").style.display = "none";
            document.getElementById("error_notific").style.display = 'none';
            menuDefaultActive();
        });
    </script>
    <script src="../js/player-navigation.js"></script>
</body>

</html>