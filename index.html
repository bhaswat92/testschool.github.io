<!DOCTYPE html>
<html>

<head>
<<<<<<< Updated upstream
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Studious - Education Category Responsive Website Template - Home : W3Layouts</title>
    <!-- google-fonts -->
    
    <!-- //google-fonts -->
    <!-- Template CSS Style link -->
    <link rel="stylesheet" href="assets/css/style-starter.css">
=======
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="muvi entertainment pvt. ltd">
	<title>Home</title>

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="../css/bootstrap.min.css">
	<link rel="stylesheet" href="../css/bootstrap.min.css">

	<!-- jquery -->
	<script src="../libs/caph/3.0.1/bower_components/jquery/dist/jquery.min.js"></script>
	<script src="../js/jquery-3.3.1.min.js"></script>
	<script src="../js/bootstrap.min.js"></script>
	<script type="text/javascript" src="$WEBAPIS/webapis/webapis.js"></script>
	<style>
		body {
			background-image: url("images/splash.png");
			background-size: cover;
		}

		.modal-content {
			background-color: #000;
			border-radius: .3rem;
			color: #fff;
			border-radius: 1rem;
			pointer-events: none;
		}

		.modal-title {
			font-size: 45px;
			font-weight: 600;
		}

		.cus-desc {
			font-size: 2.2rem;
			font-weight: 400;
		}

		.cus-btn {
			padding: 8px 59px;
			font-size: 20px;
		}

		.cus-btn.current {
			background: #16ddf8;
			color: #fff !important;
			border: 1px solid #16ddf8;
			border-radius: 0.25rem;
			font-weight: 600;
		}
	</style>
>>>>>>> Stashed changes
</head>

<body id="mainbody">
	<div class="modal fade" class="notification" id="notification" tabindex="-1" role="dialog"
		aria-labelledby="notificationTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<div class="container-fluid">
						<div class="row">
							<div class="col-lg-12 ">
								<h5 class="modal-title text-center" id="exampleModalLongTitle">Geo location blocked!!
								</h5>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-body">
					<div class="container-fluid">
						<div class="row">
							<div class="col-lg-12">
								<p class="text-center cus-desc">Account is blocked due to geo location</p>
							</div>
						</div>
						<div class="row">
							<div class="col-lg-12 text-center" id="exitBody">
								<button type="button" class="btn btn-lg cus-btn current" id="exit">App Exit!</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		function getMinutesBetweenTimes(startTime, endTime) {
			var diff = startTime - endTime;
			return (diff / 60000);
		}
		var init = function () {
			if ("AppExit" in localStorage) {
				goWithoutHistory();
			} else {
				if ("Lastclear" in localStorage) {
					if (localStorage.getItem("appExit") == 1) {
						goWithoutHistory();
					} else {
						let res = getMinutesBetweenTimes((new Date()).getTime(), localStorage.getItem('Lastclear'));
						if (res >= 5) {
							goWithoutHistory();
						} else {
							if ("historyUrl" in localStorage) {
								localStorage.removeItem("AppExit");
								window.location.href = localStorage.getItem("historyUrl");
							} else {
								goWithoutHistory();
							}
						}
					}
				} else {
					goWithoutHistory();
				}
			}

		}
		window.onload = init;

		function goWithoutHistory() {
			localStorage.removeItem("AppExit");
			localStorage.removeItem('appExit');
			localStorage.removeItem('Lastclear');
			localStorage.removeItem('customCounter');
			localStorage.setItem("authtokenstr", "92b9a7907748d038f3277feafcf07506");
			localStorage.setItem("baseurl", "https://api.muvi.com/rest/");
			localStorage.setItem("ipbaseurl", "https://api.ipify.org/?format=json");

			if (localStorage.getItem("authtokenstr") != null) {
				var authtoken = localStorage.getItem("authtokenstr");
				var baseurl = localStorage.getItem("baseurl");
				var lang_code = localStorage.getItem("lang_code");
				var ipbaseurl = localStorage.getItem("ipbaseurl");
			} else {
				localStorage.setItem("lang_code", "en");
			}

			function isRegistrationEnable() {
				var isRegistration = new XMLHttpRequest();
				isRegistration.open("POST", "" + baseurl + "isRegistrationEnabled/", true);
				isRegistration.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
				isRegistration.onreadystatechange = function () {
					if (this.readyState == 4 && this.status == 200) {
						var indexResponse = JSON.parse(this.responseText);
						if (indexResponse.code == "200") {
							localStorage.setItem("Mylibrary", indexResponse.isMylibrary);
							localStorage.setItem("WatchHistory", indexResponse.watch_history);
							localStorage.setItem("Myfavorite", indexResponse.has_favourite);
							localStorage.setItem("isRegistrationEnabled", indexResponse.is_season_available);
							var timer = setTimeout(function () {
								if (localStorage.getItem("loginstr") != null) {
									window.location.href = "homepage.html"
								} else {
									window.location.href = "languagelisting.html"
								}
							}, 2000);
						} else {
							window.location.href = "languagelisting.html"
							// if (localStorage.getItem("loginstr") != null) {
							// 	window.location.href = "homepage.html"
							// } else {
							// 	window.location.href = "languagelisting.html"
							// }
						}
					} else {
						//console.warn("No Response From Server");
					}
				};
				isRegistration.send("authToken=" + authtoken + "");
			}

			function geoBlockCheck(ip) {
				var geoBlock = new XMLHttpRequest();
				geoBlock.onreadystatechange = function () {
					if (this.readyState == 4 && this.status == 200) {
						var geoBlock_response = JSON.parse(this.responseText);
						if (geoBlock_response.code == 200) {
							console.log(geoBlock_response);
							localStorage.setItem("country", geoBlock_response.country);
							isRegistrationEnable();
						} else {
							$(".cus-desc").text(geoBlock_response.msg);
							$('#notification').modal('show');
						}
					}
				}
				geoBlock.open("GET", "" + baseurl + "CheckGeoBlock?authToken=" + authtoken + "&ip=" + ip + "", true);
				geoBlock.send();
			}
			function getIpAddress() {
				var ipaddress = new XMLHttpRequest();
				ipaddress.onreadystatechange = function () {
					if (this.readyState == 4 && this.status == 200) {
						var ipaddress_response = JSON.parse(this.responseText);
						console.log(ipaddress_response);
						localStorage.setItem("ip_address", ipaddress_response.ip);
						geoBlockCheck(ipaddress_response.ip);
					}
				}
				ipaddress.open("GET", localStorage.getItem("ipbaseurl"), true);
				ipaddress.send();
			}
			getIpAddress();
		}
	</script>
	<script>
		document.onkeydown = checkKey;
		function checkKey(e) {
			e = e || window.event;
			console.log(e.keyCode)
			if (e.keyCode == '13') {
				var $current = $('.current');
				var currentId = $current.get()[0].id;
				var currentParentId = $current.parent().get()[0].id;
				if (currentParentId === "exitBody") {
					localStorage.removeItem('Lastclear');
					localStorage.removeItem('customCounter');
					$('#notification').modal('hide');
					tizen.application.getCurrentApplication().exit();
				}
			}
		}
	</script>
</body>

</html>
